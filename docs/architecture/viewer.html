<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GeoQuests Architecture Diagrams</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        :root {
            --bg-primary: #0d1117;
            --bg-secondary: #161b22;
            --bg-tertiary: #21262d;
            --text-primary: #e6edf3;
            --text-secondary: #8b949e;
            --accent: #58a6ff;
            --accent-hover: #79b8ff;
            --border: #30363d;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans', Helvetica, Arial, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
        }

        .header {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header h1 {
            font-size: 1.5rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .header h1 span {
            font-size: 1.8rem;
        }

        .container {
            display: flex;
            min-height: calc(100vh - 60px);
        }

        .sidebar {
            width: 280px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border);
            padding: 1rem 0;
            position: sticky;
            top: 60px;
            height: calc(100vh - 60px);
            overflow-y: auto;
        }

        .sidebar-section {
            margin-bottom: 1.5rem;
        }

        .sidebar-section h3 {
            color: var(--text-secondary);
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            padding: 0.5rem 1rem;
        }

        .sidebar-item {
            display: block;
            padding: 0.6rem 1rem;
            color: var(--text-primary);
            text-decoration: none;
            font-size: 0.9rem;
            cursor: pointer;
            border-left: 3px solid transparent;
            transition: all 0.15s ease;
        }

        .sidebar-item:hover {
            background: var(--bg-tertiary);
            border-left-color: var(--accent);
        }

        .sidebar-item.active {
            background: var(--bg-tertiary);
            border-left-color: var(--accent);
            color: var(--accent);
        }

        .main {
            flex: 1;
            padding: 2rem;
            overflow-x: auto;
        }

        .diagram-container {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            overflow: hidden;
        }

        .diagram-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.5rem;
            background: var(--bg-tertiary);
            border-bottom: 1px solid var(--border);
        }

        .diagram-title {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .zoom-controls {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .zoom-btn {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            color: var(--text-primary);
            padding: 0.4rem 0.8rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.15s ease;
        }

        .zoom-btn:hover {
            background: var(--bg-primary);
            border-color: var(--accent);
        }

        .zoom-level {
            color: var(--text-secondary);
            font-size: 0.85rem;
            min-width: 50px;
            text-align: center;
        }

        .diagram-wrapper {
            padding: 2rem;
            overflow: auto;
            max-height: calc(100vh - 200px);
            display: flex;
            justify-content: center;
        }

        .diagram-content {
            transform-origin: center center;
            transition: transform 0.2s ease;
        }

        .mermaid {
            background: transparent !important;
        }

        /* Make Mermaid diagrams larger by default */
        .mermaid svg {
            max-width: none !important;
            height: auto !important;
        }

        /* Modal for fullscreen view */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-secondary);
            border-radius: 12px;
            width: 95vw;
            height: 95vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.5rem;
            background: var(--bg-tertiary);
            border-bottom: 1px solid var(--border);
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
            line-height: 1;
        }

        .modal-close:hover {
            color: var(--accent);
        }

        .modal-body {
            flex: 1;
            overflow: auto;
            padding: 2rem;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }

        .modal-diagram {
            transform-origin: top center;
        }

        .fullscreen-btn {
            background: var(--accent);
            color: var(--bg-primary);
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.15s ease;
        }

        .fullscreen-btn:hover {
            background: var(--accent-hover);
        }

        /* Description text */
        .diagram-description {
            padding: 1rem 1.5rem;
            background: var(--bg-tertiary);
            border-top: 1px solid var(--border);
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* Loading state */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 4rem;
            color: var(--text-secondary);
        }

        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }
            .main {
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <h1><span>üåç</span> GeoQuests Architecture Diagrams</h1>
    </header>

    <div class="container">
        <nav class="sidebar">
            <div class="sidebar-section">
                <h3>High-Level Design</h3>
                <div class="sidebar-item active" data-diagram="hld-system">System Architecture</div>
                <div class="sidebar-item" data-diagram="hld-flow">Data Flow</div>
                <div class="sidebar-item" data-diagram="hld-deploy">Deployment</div>
            </div>
            <div class="sidebar-section">
                <h3>Low-Level Design</h3>
                <div class="sidebar-item" data-diagram="lld-frontend">Frontend Components</div>
                <div class="sidebar-item" data-diagram="lld-backend">Backend Services</div>
                <div class="sidebar-item" data-diagram="lld-agents">AI Agents</div>
                <div class="sidebar-item" data-diagram="lld-state">Quest State Machine</div>
            </div>
            <div class="sidebar-section">
                <h3>Database</h3>
                <div class="sidebar-item" data-diagram="erd">Entity Relationship</div>
            </div>
            <div class="sidebar-section">
                <h3>Sequence Diagrams</h3>
                <div class="sidebar-item" data-diagram="seq-create">Quest Creation</div>
                <div class="sidebar-item" data-diagram="seq-complete">Quest Completion</div>
                <div class="sidebar-item" data-diagram="seq-payment">Payment Flow</div>
                <div class="sidebar-item" data-diagram="seq-challenge">Challenge Entry</div>
            </div>
        </nav>

        <main class="main">
            <div class="diagram-container">
                <div class="diagram-header">
                    <span class="diagram-title" id="diagramTitle">System Architecture</span>
                    <div class="zoom-controls">
                        <button class="zoom-btn" onclick="zoomOut()">‚àí</button>
                        <span class="zoom-level" id="zoomLevel">100%</span>
                        <button class="zoom-btn" onclick="zoomIn()">+</button>
                        <button class="zoom-btn" onclick="resetZoom()">Reset</button>
                        <button class="fullscreen-btn" onclick="openFullscreen()">‚õ∂ Fullscreen</button>
                    </div>
                </div>
                <div class="diagram-wrapper" id="diagramWrapper">
                    <div class="diagram-content" id="diagramContent">
                        <div class="mermaid" id="diagram"></div>
                    </div>
                </div>
                <div class="diagram-description" id="diagramDescription">
                    High-level overview of the GeoQuests system architecture showing all major components.
                </div>
            </div>
        </main>
    </div>

    <!-- Fullscreen Modal -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="diagram-title" id="modalTitle">System Architecture</span>
                <div class="zoom-controls">
                    <button class="zoom-btn" onclick="modalZoomOut()">‚àí</button>
                    <span class="zoom-level" id="modalZoomLevel">100%</span>
                    <button class="zoom-btn" onclick="modalZoomIn()">+</button>
                    <button class="zoom-btn" onclick="modalResetZoom()">Reset</button>
                    <button class="modal-close" onclick="closeFullscreen()">‚úï</button>
                </div>
            </div>
            <div class="modal-body">
                <div class="modal-diagram" id="modalDiagram"></div>
            </div>
        </div>
    </div>

    <script>
        // Diagram definitions
        const diagrams = {
            'hld-system': {
                title: 'System Architecture',
                description: 'High-level overview showing all major components: clients, API gateway, services, AI agents, and data stores.',
                code: `flowchart TB
    subgraph clients ["üñ•Ô∏è Client Layer"]
        web["Web App<br/>(Next.js 14)"]
        pwa["Mobile PWA"]
    end

    subgraph gateway ["üö™ API Gateway"]
        api["FastAPI<br/>(Python)"]
        ws["WebSocket"]
    end

    subgraph services ["‚öôÔ∏è Service Layer"]
        auth["Auth"]
        quest["Quest"]
        submission["Submission"]
        social["Social"]
        event["Event"]
        payment["Payment"]
    end

    subgraph ai ["ü§ñ AI Agent Layer"]
        validator["Quest Validator"]
        processor["Photo Processor"]
        matcher["Content Matcher"]
    end

    subgraph data ["üíæ Data Layer"]
        pg[("PostgreSQL<br/>+ PostGIS")]
        redis[("Redis")]
        r2[("Cloudflare R2")]
    end

    subgraph external ["üåê External"]
        stripe["Stripe"]
        mapbox["Mapbox"]
        openai["OpenAI"]
    end

    web --> api
    pwa --> api
    api --> auth & quest & submission & social & event & payment
    quest --> validator
    submission --> processor & matcher
    validator & matcher --> openai
    auth --> pg & redis
    quest & submission --> pg
    submission --> r2
    payment --> stripe
    web --> mapbox`
            },
            'hld-flow': {
                title: 'Data Flow',
                description: 'How data flows through the system from quest creation to completion.',
                code: `flowchart LR
    subgraph create ["Quest Creation"]
        C1[Creator] --> Q1[Create Quest]
        Q1 --> V1{AI Validate}
        V1 -->|Safe| L1[Quest Live]
        V1 -->|Unsafe| R1[Rejected]
    end

    subgraph complete ["Quest Completion"]
        E1[Explorer] --> D1[Discover]
        D1 --> T1[Travel]
        T1 --> S1[Submit Photo]
        S1 --> V2{Verify}
        V2 -->|Pass| C2[Complete!]
        V2 -->|Fail| F1[Rejected]
    end

    subgraph reward ["Rewards"]
        C2 --> B1[Badge]
        C2 --> P1{Paid?}
        P1 -->|Yes| M1[Payment]
        P1 -->|No| N1[Notify]
    end

    L1 --> E1`
            },
            'hld-deploy': {
                title: 'Deployment Architecture',
                description: 'Infrastructure and hosting setup for the GeoQuests platform.',
                code: `flowchart LR
    subgraph vercel ["Vercel"]
        next["Next.js App"]
    end

    subgraph railway ["Railway"]
        fastapi["FastAPI"]
        worker["Workers"]
    end

    subgraph managed ["Managed Services"]
        supabase["Supabase<br/>(Postgres)"]
        upstash["Upstash<br/>(Redis)"]
        r2["Cloudflare R2"]
    end

    subgraph external ["External APIs"]
        stripe["Stripe"]
        openai["OpenAI"]
        mapbox["Mapbox"]
    end

    next --> fastapi
    fastapi --> supabase & upstash & r2
    fastapi --> stripe & openai
    next --> mapbox`
            },
            'lld-frontend': {
                title: 'Frontend Components',
                description: 'Next.js page structure and component hierarchy.',
                code: `flowchart TB
    subgraph pages ["üìÑ Pages"]
        home["/ Landing"]
        map["/map Quest Map"]
        create["/quest/create"]
        detail["/quest/[id]"]
        complete["/quest/[id]/complete"]
        friends["/friends"]
        challenges["/challenges"]
        profile["/profile/[id]"]
    end

    subgraph components ["üß© Components"]
        MapView
        QuestCard
        CameraCapture
        GeoLocationLock
        FriendList
        PaymentModal
    end

    subgraph hooks ["ü™ù Hooks"]
        useGeolocation
        useQuests
        useCamera
        useAuth
        useFriends
    end

    map --> MapView
    create --> QuestCard
    complete --> CameraCapture & GeoLocationLock
    friends --> FriendList
    detail --> PaymentModal
    
    MapView --> useQuests
    CameraCapture --> useCamera & useGeolocation`
            },
            'lld-backend': {
                title: 'Backend Services',
                description: 'FastAPI service layer and dependencies.',
                code: `flowchart TB
    subgraph api ["üöÄ API Routes"]
        authRoute["/auth"]
        questRoute["/quests"]
        submissionRoute["/submissions"]
        socialRoute["/social"]
        eventRoute["/events"]
        paymentRoute["/payments"]
    end

    subgraph services ["‚öôÔ∏è Services"]
        AuthService
        QuestService
        SubmissionService
        SocialService
        EventService
        PaymentService
    end

    subgraph agents ["ü§ñ AI Agents"]
        QuestValidator
        PhotoProcessor
        ContentMatcher
    end

    subgraph models ["üì¶ Models"]
        User
        Quest
        Submission
        Friendship
        Payment
        Badge
    end

    authRoute --> AuthService
    questRoute --> QuestService
    submissionRoute --> SubmissionService
    socialRoute --> SocialService
    eventRoute --> EventService
    paymentRoute --> PaymentService

    QuestService --> QuestValidator
    SubmissionService --> PhotoProcessor & ContentMatcher

    AuthService --> User
    QuestService --> Quest
    SubmissionService --> Submission
    SocialService --> Friendship
    PaymentService --> Payment`
            },
            'lld-agents': {
                title: 'AI Agent Pipeline',
                description: 'AI verification flow for quests and photo submissions.',
                code: `flowchart LR
    subgraph input ["üì• Input"]
        questInput["Quest Request"]
        photoInput["Photo + GPS"]
    end

    subgraph questAgents ["Quest Validation"]
        locCheck["Location<br/>Checker"]
        privacyCheck["Privacy<br/>Analyzer"]
    end

    subgraph photoAgents ["Photo Processing"]
        gpsVerify["GPS<br/>Verifier"]
        faceBlur["Face<br/>Blur"]
        contentMatch["Content<br/>Matcher"]
    end

    subgraph output ["üì§ Output"]
        questVerdict["SAFE / UNSAFE"]
        photoVerdict["VERIFIED"]
    end

    questInput --> locCheck & privacyCheck
    locCheck & privacyCheck --> questVerdict

    photoInput --> gpsVerify & faceBlur & contentMatch
    gpsVerify & faceBlur & contentMatch --> photoVerdict`
            },
            'lld-state': {
                title: 'Quest State Machine',
                description: 'Quest lifecycle states and transitions.',
                code: `stateDiagram-v2
    [*] --> draft: Creator starts

    draft --> validating: Submit
    validating --> rejected: AI flags
    validating --> active: Approved

    rejected --> draft: Edit

    active --> completed: Social quest done
    active --> pending_payment: Paid quest done
    active --> expired: Deadline

    pending_payment --> completed: Paid
    pending_payment --> expired: Timeout

    completed --> [*]
    expired --> [*]`
            },
            'erd': {
                title: 'Entity Relationship Diagram',
                description: 'Complete database schema showing all tables and relationships.',
                code: `erDiagram
    USERS {
        uuid id PK
        string email UK
        string username UK
        string name
        int xp
        int level
        int quests_completed
    }

    FRIENDSHIPS {
        uuid id PK
        uuid user_id FK
        uuid friend_id FK
        enum status
    }

    QUESTS {
        uuid id PK
        uuid creator_id FK
        geography location
        string title
        enum type
        enum visibility
        int price_cents
        enum status
    }

    SUBMISSIONS {
        uuid id PK
        uuid quest_id FK
        uuid explorer_id FK
        string image_url
        geography captured_location
        int content_match_score
        enum status
    }

    PAYMENTS {
        uuid id PK
        uuid submission_id FK
        int amount_cents
        int platform_fee_cents
        int explorer_payout_cents
    }

    BADGES {
        uuid id PK
        string slug UK
        string name
        enum rarity
        enum category
    }

    USER_BADGES {
        uuid id PK
        uuid user_id FK
        uuid badge_id FK
        timestamp earned_at
    }

    USERS ||--o{ QUESTS : creates
    USERS ||--o{ SUBMISSIONS : completes
    USERS ||--o{ FRIENDSHIPS : has
    USERS ||--o{ USER_BADGES : earns
    QUESTS ||--o{ SUBMISSIONS : has
    SUBMISSIONS ||--o| PAYMENTS : triggers
    BADGES ||--o{ USER_BADGES : awarded`
            },
            'seq-create': {
                title: 'Quest Creation Sequence',
                description: 'Full flow when a user creates a new quest.',
                code: `sequenceDiagram
    autonumber
    participant U as User
    participant W as Web App
    participant A as API
    participant V as Validator
    participant DB as Database

    U->>W: Click location on map
    U->>W: Fill quest details
    U->>W: Click "Create Quest"
    
    W->>A: POST /quests
    A->>V: validate(quest)
    
    alt Location Private
        V-->>A: REJECTED
        A-->>W: 400 Error
        W-->>U: ‚ùå Private location
    else All OK
        V-->>A: APPROVED
        A->>DB: INSERT quest
        A-->>W: 201 Created
        W-->>U: ‚úÖ Quest live!
    end`
            },
            'seq-complete': {
                title: 'Quest Completion Sequence',
                description: 'Flow when an explorer completes a quest.',
                code: `sequenceDiagram
    autonumber
    participant E as Explorer
    participant W as Web App
    participant G as GPS API
    participant C as Camera
    participant A as API
    participant AI as AI Agents
    participant DB as Database

    E->>W: View quest, tap "Complete"
    W->>G: Get position
    G-->>W: Location (lat, lng)
    
    W->>W: Check within radius
    W-->>E: ‚úÖ You're here!
    
    W->>C: Open camera
    E->>W: Take photo
    
    W->>A: POST /submissions
    
    par Verify
        A->>AI: Check GPS
        A->>AI: Blur faces
        A->>AI: Match content
    end
    
    AI-->>A: Verified ‚úì
    A->>DB: Save submission
    A-->>W: Quest complete!
    W-->>E: üéâ Badge earned!`
            },
            'seq-payment': {
                title: 'Payment Flow Sequence',
                description: 'Payment flow for paid quests.',
                code: `sequenceDiagram
    autonumber
    participant C as Creator
    participant W as Web App
    participant A as API
    participant S as Stripe
    participant E as Explorer

    C->>W: View verified photo preview
    C->>W: Click "Pay to Unlock"
    
    W->>A: POST /payments/checkout
    A->>S: Create PaymentIntent
    S-->>A: client_secret
    A-->>W: Checkout session
    
    W->>W: Show Stripe form
    C->>W: Enter card, pay
    W->>S: Confirm payment
    
    S->>A: Webhook: succeeded
    A->>A: Update submission
    A-->>E: üí∞ $12 payout!
    
    W->>A: GET /submissions/{id}/full
    A-->>W: Full image URL
    W-->>C: üñºÔ∏è Photo unlocked!`
            },
            'seq-challenge': {
                title: 'Challenge Entry Sequence',
                description: 'Flow for entering platform challenges.',
                code: `sequenceDiagram
    autonumber
    participant U as User
    participant W as Web App
    participant A as API
    participant AI as AI Scorer
    participant DB as Database

    U->>W: Browse /challenges
    W->>A: GET /events?active
    A-->>W: Challenge list
    
    U->>W: Select challenge
    U->>W: Capture photo
    U->>W: Submit entry
    
    W->>A: POST /events/{id}/entries
    
    A->>AI: Score photo
    Note right of AI: Composition: 85<br/>Theme: 92<br/>Quality: 88
    AI-->>A: Score: 86
    
    A->>DB: Save entry
    A-->>W: Entry submitted
    W-->>U: Score: 86, Rank: #47`
            }
        };

        let currentZoom = 1;
        let modalZoom = 1;
        let currentDiagram = 'hld-system';

        // Initialize Mermaid
        mermaid.initialize({
            startOnLoad: false,
            theme: 'dark',
            themeVariables: {
                darkMode: true,
                background: '#161b22',
                primaryColor: '#238636',
                primaryTextColor: '#e6edf3',
                primaryBorderColor: '#30363d',
                lineColor: '#8b949e',
                secondaryColor: '#21262d',
                tertiaryColor: '#161b22'
            },
            flowchart: {
                useMaxWidth: false,
                htmlLabels: true,
                curve: 'basis'
            },
            sequence: {
                useMaxWidth: false,
                diagramMarginX: 50,
                diagramMarginY: 30,
                actorMargin: 50,
                width: 150,
                height: 65
            },
            er: {
                useMaxWidth: false,
                layoutDirection: 'TB'
            }
        });

        async function renderDiagram(diagramId) {
            const diagram = diagrams[diagramId];
            if (!diagram) return;

            currentDiagram = diagramId;
            document.getElementById('diagramTitle').textContent = diagram.title;
            document.getElementById('diagramDescription').textContent = diagram.description;

            // Update sidebar active state
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.diagram === diagramId) {
                    item.classList.add('active');
                }
            });

            // Reset zoom
            resetZoom();

            // Render diagram
            const container = document.getElementById('diagram');
            container.innerHTML = '';
            
            try {
                const { svg } = await mermaid.render('mermaid-' + Date.now(), diagram.code);
                container.innerHTML = svg;
            } catch (e) {
                container.innerHTML = '<p style="color: #f85149;">Error rendering diagram</p>';
                console.error(e);
            }
        }

        function zoomIn() {
            currentZoom = Math.min(currentZoom + 0.25, 3);
            applyZoom();
        }

        function zoomOut() {
            currentZoom = Math.max(currentZoom - 0.25, 0.25);
            applyZoom();
        }

        function resetZoom() {
            currentZoom = 1;
            applyZoom();
        }

        function applyZoom() {
            document.getElementById('diagramContent').style.transform = `scale(${currentZoom})`;
            document.getElementById('zoomLevel').textContent = Math.round(currentZoom * 100) + '%';
        }

        function openFullscreen() {
            const modal = document.getElementById('modal');
            const diagram = diagrams[currentDiagram];
            
            document.getElementById('modalTitle').textContent = diagram.title;
            modal.classList.add('active');
            
            modalZoom = 1;
            modalResetZoom();
            
            const modalDiagram = document.getElementById('modalDiagram');
            modalDiagram.innerHTML = document.getElementById('diagram').innerHTML;
        }

        function closeFullscreen() {
            document.getElementById('modal').classList.remove('active');
        }

        function modalZoomIn() {
            modalZoom = Math.min(modalZoom + 0.25, 5);
            applyModalZoom();
        }

        function modalZoomOut() {
            modalZoom = Math.max(modalZoom - 0.25, 0.25);
            applyModalZoom();
        }

        function modalResetZoom() {
            modalZoom = 1;
            applyModalZoom();
        }

        function applyModalZoom() {
            document.getElementById('modalDiagram').style.transform = `scale(${modalZoom})`;
            document.getElementById('modalZoomLevel').textContent = Math.round(modalZoom * 100) + '%';
        }

        // Event listeners
        document.querySelectorAll('.sidebar-item').forEach(item => {
            item.addEventListener('click', () => {
                renderDiagram(item.dataset.diagram);
            });
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeFullscreen();
            if (e.key === '+' || e.key === '=') {
                if (document.getElementById('modal').classList.contains('active')) {
                    modalZoomIn();
                } else {
                    zoomIn();
                }
            }
            if (e.key === '-') {
                if (document.getElementById('modal').classList.contains('active')) {
                    modalZoomOut();
                } else {
                    zoomOut();
                }
            }
        });

        // Close modal on background click
        document.getElementById('modal').addEventListener('click', (e) => {
            if (e.target.id === 'modal') closeFullscreen();
        });

        // Initial render
        renderDiagram('hld-system');
    </script>
</body>
</html>
